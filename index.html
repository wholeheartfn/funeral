<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ë¶€ê³ ì¥ ì •ë³´ ì…ë ¥</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@700;900&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#fff6f3;--card:#fff;--accent:#6fcf97;--accent-dark:#57b87a;--radius:.95rem}
    html{font-size:17px}
    html,body{height:100%;font-family:"Pretendard","Noto Sans KR",sans-serif}
    body{background:var(--bg)}
    .page-wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:2rem 1rem}
    .card{width:100%;max-width:22rem;background:var(--card);border-radius:var(--radius);box-shadow:0 8px 32px rgba(231,111,102,0.13);padding:2.2rem 1rem 2.2rem;animation:fade .45s ease}
    @keyframes fade{from{opacity:0;transform:translateY(18px)}to{opacity:1;transform:translateY(0)}}
    h2{display:flex;align-items:center;gap:.55rem;font-weight:700;color:var(--accent);line-height:1.3}
    #intro h2,#formPage h2,#summary h2{font-size:1.6rem}.icon{font-size:1.55rem}
    .info-note{font-size:1.05rem;line-height:1.6;color:#8c4e4a}
    .field label{display:block;font-size:1.08rem;font-weight:600;color:#3d3d3d;margin-bottom:.4rem;letter-spacing:-0.01em}
    input,select{width:100%;min-height:48px;padding:0.625rem;font-size:1.08rem;border:1px solid #e2e4e7;border-radius:.45rem;background:#fff;transition:border .15s,box-shadow .15s}
    input::placeholder{color:#d1bdbb;opacity:1}
    input:focus,select:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 3px rgba(231,111,102,.18)}
    select{background:none;padding-right:0.625rem;}
    .btn{display:inline-flex;align-items:center;justify-content:center;font-weight:600;border:none;cursor:pointer;border-radius:var(--radius);transition:background .15s,transform .12s,box-shadow .15s;min-height:48px;font-size:1.13rem;box-shadow:0 2px 8px rgba(231,111,102,0.08)}
    .btn:active{transform:scale(.97)}
    .btn-primary{background:var(--accent);color:#fff;width:100%}
    .btn-primary:hover,.btn-primary:focus{background:linear-gradient(90deg,#6fcf97 80%,#a8f5c2 100%);box-shadow:0 4px 16px rgba(111,207,151,0.13)}
    .btn-secondary{background:#e6fbe9;color:#388e5c;width:100%}
    .btn-secondary:hover{background:#c8f5d6}
    #editBtn{width:34%;margin:1.3rem auto 0}
    #mournersWrap>div{border:1px solid #f0b7b3;border-radius:.5rem;background:#fffafa;padding:1rem .9rem;margin-top:.9rem}
    .upperInfo{border:1px solid #f0b7b3;border-radius:.55rem;background:#fffdfa;padding:1rem .9rem;margin-top:1.25rem}
    .summary-grid{display:grid;grid-template-columns:minmax(100px,120px) 1fr;row-gap:.55rem;column-gap:.5rem;font-size:1.05rem}
    .label{font-weight:600;color:#444}
    .nowrap{white-space:nowrap}
    hr{border-color:#d2f5e1}
    #msg{min-height:1.05rem;font-size:.98rem}
    @media (max-width:480px){.card{box-shadow:0 8px 32px rgba(231,111,102,0.13);}}
  </style>
</head>
<body>
  <div class="page-wrap" style="flex-direction:column; align-items:center;">
    <!-- ì¸ì‚¬ë§ì€ summary(ìš”ì•½) ì¹´ë“œ ì•ˆì—ì„œë§Œ ë…¸ì¶œ -->

    <!-- Intro -->
    <div id="intro" class="card space-y-7">
      <div class="leading-relaxed space-y-1">
        <p class="text-[1.45rem] font-semibold text-gray-800">ì°¸ì •ì„±ê°€ë“ ìš°ë¦¬ìƒì¡°ì™€</p>
        <p class="text-lg text-gray-700">í•¨ê»˜ í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤</p>
        <p class="info-note mt-2">ìƒì£¼ ì •ë³´ë¥¼ ì‘ì„±í•˜ì‹  í›„<br>ë‹µë¬¸ì í•˜ë‚˜ ë¶€íƒë“œë ¤ìš”<br>ê°ì‚¬í•©ë‹ˆë‹¤.</p>
      </div>
      <h2><span class="icon">ğŸ•Šï¸</span> ë¶€ê³ ì¥ ìƒì£¼ ì •ë³´</h2>
      <div class="field"><label for="introName">ê³ ì¸ë¶„ ì„±í•¨ì„ ì…ë ¥í•´ì£¼ì„¸ìš”</label><input id="introName" class="p-2.5" placeholder="í™ê¸¸ë™" autofocus autocomplete="on" autocapitalize="off" spellcheck="false"></div>
      <button id="startBtn" class="btn btn-primary">ì‘ì„±í•˜ê¸°</button>
      <p id="msg" class="text-xs mt-5 text-center"></p>
    </div>

    <!-- Form -->
    <div id="formPage" class="card hidden" style="max-height:90vh; overflow-y: auto;">
      <h2><span class="icon">ğŸ—’ï¸</span> ë¶€ê³ ì¥ ì •ë³´ ì…ë ¥</h2>
      <div class="upperInfo space-y-4" style="background:#f3fff3;">
        <div class="flex items-center mb-2 text-base font-semibold text-green-700">ë¨¼ì € ê³ ì¸ë¶„ ì¸ì ì‚¬í•­ì„ ì ì–´ì£¼ì„¸ìš”</div>
        <div class="grid grid-cols-6 gap-2">
          <!-- 1ì¤„ -->
          <input id="deceasedName" class="col-span-2 p-2.5 w-full min-w-0" placeholder="ê³ ì¸ì„±í•¨" autocomplete="on" autocapitalize="off" spellcheck="false">
          <select id="gender" class="col-span-2 p-2.5 w-full min-w-0" autocomplete="off">
            <option value="" disabled selected hidden>ì„±ë³„</option>
            <option>ë‚¨</option>
            <option>ì—¬</option>
          </select>
          <input id="deceasedAge" type="number" class="col-span-2 p-2.5 w-full min-w-0" placeholder="ë‚˜ì´" autocomplete="off" inputmode="numeric" pattern="[0-9]*">
          <!-- 2ì¤„(í•œ ì¤„ë¡œ) -->
          <select id="religion" class="col-span-3 p-2.5 w-full min-w-0" autocomplete="off">
            <option value="" disabled selected hidden>ì¢…êµ</option>
            <option>ë¶ˆêµ</option>
            <option>ê¸°ë…êµ</option>
            <option>ì²œì£¼êµ</option>
            <option>ë¬´êµ</option>
            <option>ê¸°íƒ€</option>
          </select>
          <div class="col-span-3 flex items-center gap-2 ml-2">
            <label for="origin" class="text-gray-700 mb-0" style="font-size:1.08rem;font-weight:600;">ë³¸</label>
            <input id="origin" class="p-2.5 w-full min-w-0" placeholder="ê²½ì£¼" autocomplete="on" autocapitalize="off" spellcheck="false">
          </div>
        </div>
        <div class="grid grid-cols-2 gap-2">
          <div class="field"><label for="funeralHall" style="font-size:1.08rem;font-weight:600;">ì¥ë¡€ì‹ì¥</label><input id="funeralHall" class="p-2.5" autocomplete="on" autocapitalize="off" spellcheck="false"></div>
          <div class="field"><label for="hallRoom" style="font-size:1.08rem;font-weight:600;">ë¹ˆì†Œ</label><input id="hallRoom" class="p-2.5" autocomplete="off" autocapitalize="off" spellcheck="false"></div>
        </div>
        <div class="field"><label for="burialSite" style="font-size:1.08rem;font-weight:600;">ì¥ì§€</label><input id="burialSite" class="p-2.5" autocomplete="on" autocapitalize="off" spellcheck="false"></div>
      </div>
      <div id="mournersGuide" class="text-green-700 font-semibold" style="margin-top:2rem;margin-bottom:0.4rem;text-align:left;max-width:22rem;font-size:1rem;line-height:1.5;word-break:keep-all;">
        ìƒì£¼ì •ë³´ ì…ë ¥ì‹œ<br>ê°€ê¸‰ì ì´ë©´ ê´€ê³„ ìˆœìœ¼ë¡œ ì‘ì„±ì„ ë¶€íƒë“œë ¤ìš”
      </div>
      <div id="mournersWrap" class="mt-2"></div>
      <button id="addBtn" type="button" class="btn btn-secondary mt-4">â• ìƒì£¼ ì¶”ê°€</button>
      <p id="msg" class="text-xs mt-5 text-center text-red-500"></p>
      <button id="submitBtn" class="btn btn-primary mt-2">ì €ì¥ / ì œì¶œ</button>
    </div>

    <!-- summary ì¹´ë“œ ìœ„ì— ì¸ì‚¬ë§ -->
    <div id="summaryGreeting" class="leading-relaxed space-y-1 mb-5 text-left select-none hidden" style="width:100%;max-width:22rem;">
      <p class="text-lg mb-1" style="color:#249c5d; font-family:'Noto Serif KR', serif; font-weight:200 !important;">ì‘ì„±í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤</p>
      <p class="text-2xl md:text-3xl font-semibold" style="color:#249c5d; font-family:'Noto Serif KR', serif; margin-bottom:1rem;">ì°¸ì •ì„±ìœ¼ë¡œ ëª¨ì‹œê² ìŠµë‹ˆë‹¤</p>
      <p class="info-note" style="margin-top:0.5rem; margin-bottom:0.8rem;">ì‘ì„±ì´ ì™„ë£Œë˜ì…¨ìœ¼ë©´ ë‹µë¬¸ì ë¶€íƒë“œë ¤ìš”<br>ì¶”ê°€ë‚˜ ìˆ˜ì •ì€ ì–¸ì œë“  ê°€ëŠ¥í•©ë‹ˆë‹¤</p>
    </div>
    <div id="summary" class="card hidden overflow-y-auto" style="max-height:90vh; padding-top:1.5rem; padding-bottom:1.5rem;">
      <h2 class="mb-5" style="color:#249c5d;"><span class="icon">ğŸ“‹</span> ë¶€ê³ ì¥ ì •ë¦¬</h2>
      <div id="summaryContent" class="space-y-4"></div>
      <button id="editBtn" class="btn btn-primary">ìˆ˜ì • / ì¶”ê°€</button>
    </div>
  </div>

<script>
(()=>{
  const SHEET="https://script.google.com/macros/s/AKfycbyYLF9xiP-KJ6e-HwwwTvu4QleKdQ_1ZHFQFbsqoGF7iYoofJCyeKLw7MUT6AxfPGG4IA/exec";
  const $=id=>document.getElementById(id);
  const show=id=>{
    ["intro","formPage","summary"].forEach(p=>$(p).classList.toggle("hidden",p!==id));
    if (id === "summary") {
      $("summaryGreeting").classList.remove("hidden");
    } else {
      $("summaryGreeting").classList.add("hidden");
    }
  };
  const REL=["ê´€ê³„","ë°°ìš°ì","ì•„ë“¤","ë©°ëŠë¦¬","ë”¸","ì‚¬ìœ„","ì†ì","ì†ë…€","ì™¸ì†ì","ì™¸ì†ë…€","ì†ë¶€","ì†ì„œ","ì™¸ì†ë¶€","ì™¸ì†ì„œ"];
  const info = (t, e) => {
    // í˜„ì¬ ë³´ì´ëŠ” ì¹´ë“œì—ì„œë§Œ #msgë¥¼ ì°¾ì•„ ë©”ì‹œì§€ ì¶œë ¥
    const card = document.querySelector('.card:not(.hidden)');
    if (!card) return;
    const msg = card.querySelector('#msg');
    if (!msg) return;
    if (t.includes('<br>')) {
      msg.innerHTML = t;
      msg.className = "text-xs mt-5 text-center leading-relaxed" + (e ? " text-red-500" : " text-gray-600");
    } else {
      msg.textContent = t;
      msg.className = "text-xs mt-5 text-center" + (e ? " text-red-500" : " text-gray-600");
    }
  };

  /* â–¶ ì‘ì„± ì‹œì‘ */
  $("startBtn").onclick=async()=>{
    const name=$("introName").value.trim();
    if(!name){alert("ê³ ì¸ì„±í•¨ì„ ì…ë ¥í•´ì£¼ì„¸ìš”");return;}
    $("startBtn").style.display = "none";
    info("ê¸°ì¡´ì •ë³´ ì—¬ë¶€ë¥¼ í™•ì¸ì¤‘ì…ë‹ˆë‹¤.<br>ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”", false);
    // 1. êµ¬ê¸€ì‹œíŠ¸ì—ì„œ ì¡°íšŒ
    try {
      const res = await fetch(SHEET+"?deceased="+encodeURIComponent(name));
      const data = await res.json();
      if (data && data.deceased) {
        load(data);
        $("deceasedName").value = name;
        show("formPage");
        info("", false);
        $("startBtn").style.display = "";
        return;
      }
    } catch (e) {}
    // 2. êµ¬ê¸€ì‹œíŠ¸ì— ì—†ìœ¼ë©´ localStorageì—ì„œ ì¡°íšŒ
    const saved = localStorage.getItem("funeral_"+name);
    if (saved) {
      load(JSON.parse(saved));
      $("deceasedName").value = name;
      show("formPage");
    } else {
      reset();
      addRow();
      $("deceasedName").value = name;
      show("formPage");
    }
    info("", false);
    $("startBtn").style.display = "";
  };

  /* â–¶ ìƒì£¼ ì¶”ê°€ */
  $("addBtn").onclick=addRow;
  function addRow(d={}){
    const wrap=$("mournersWrap");
    const idx=wrap.children.length+1;
    const box=document.createElement("div");
    const BANKS = [
      "KBêµ­ë¯¼ì€í–‰", "ì‹ í•œì€í–‰", "ìš°ë¦¬ì€í–‰", "í•˜ë‚˜ì€í–‰", "NHë†í˜‘ì€í–‰", "IBKê¸°ì—…ì€í–‰",
      "ì¹´ì¹´ì˜¤ë±…í¬", "ì¼€ì´ë±…í¬", "í† ìŠ¤ë±…í¬",
      "SCì œì¼ì€í–‰", "í•œêµ­ì”¨í‹°ì€í–‰", "BNKë¶€ì‚°ì€í–‰", "BNKê²½ë‚¨ì€í–‰", "DGBëŒ€êµ¬ì€í–‰",
      "ê´‘ì£¼ì€í–‰", "ì „ë¶ì€í–‰", "Shìˆ˜í˜‘ì€í–‰", "ìš°ì²´êµ­", "ìƒˆë§ˆì„ê¸ˆê³ ", "ì‹ í˜‘", "ì‚°ë¦¼ì¡°í•©"
    ];
    let bankVal = d.bank || "";
    let isDirect = bankVal && !BANKS.includes(bankVal);
    box.innerHTML = `<div class='flex items-center mb-2 text-sm font-medium text-gray-600'>
      <span>ìƒì£¼ ${idx}</span>
      <button type='button' class='move-up ml-auto mr-1 rounded-full border border-gray-300 px-2 py-0.5 text-xs bg-white hover:bg-gray-100' title='ìœ„ë¡œ ì´ë™'>â–²</button>
      <button type='button' class='move-down ml-1 rounded-full border border-gray-300 px-2 py-0.5 text-xs bg-white hover:bg-gray-100' title='ì•„ë˜ë¡œ ì´ë™'>â–¼</button>
      <button type='button' class='ml-4 text-xs text-red-500 delete-btn'>ì‚­ì œ</button>
    </div>
      <div class='grid grid-cols-2 gap-2'>
        <select class='relation border border-gray-300 rounded-md p-2.5'>${REL.map(r=>`<option${r===d.relation?" selected":""}>${r}</option>`).join("")}</select>
        <input class='name border border-gray-300 rounded-md p-2.5' placeholder='ì´ë¦„' value='${d.name||""}' autocomplete="on" autocapitalize="off" spellcheck="false">
        <input class='phone col-span-2 border border-gray-300 rounded-md p-2.5' placeholder='ì—°ë½ì²˜' value='${d.phone||""}' autocomplete="off" inputmode="tel" pattern="[0-9]*">
        <div class='col-span-2 flex gap-2 items-center bank-account-wrap'></div>
      </div>`;
    // ì€í–‰ëª…+ê³„ì¢Œë²ˆí˜¸ í•œ ì¤„ì— ë°°ì¹˜
    const bankAccountWrap = box.querySelector('.bank-account-wrap');
    function renderBankField(val) {
      bankAccountWrap.innerHTML = '';
      // 'ì§ì ‘ì…ë ¥'ì´ê±°ë‚˜ ëŒ€í‘œì€í–‰ì— ì—†ëŠ” ê°’ì´ë©´ input, ì•„ë‹ˆë©´ select
      if (val === 'ì§ì ‘ì…ë ¥' || (val && !BANKS.includes(val))) {
        // input(ì€í–‰ëª…) + ê³„ì¢Œë²ˆí˜¸
        const inp = document.createElement('input');
        inp.className = 'bank-input w-24 border border-gray-300 rounded-md p-2.5';
        inp.placeholder = 'ì€í–‰ëª…';
        inp.value = val === 'ì§ì ‘ì…ë ¥' ? '' : val;
        inp.autocomplete = 'off';
        inp.autocapitalize = 'off';
        inp.spellcheck = false;
        setTimeout(()=>inp.focus(), 0);
        inp.onblur = () => {
          if (BANKS.includes(inp.value)) {
            renderBankField(inp.value);
          }
        };
        inp.onkeydown = (e) => {
          if (e.key === 'Enter') {
            inp.blur();
          }
        };
        bankAccountWrap.appendChild(inp);
        // ê³„ì¢Œë²ˆí˜¸ input
        const acc = document.createElement('input');
        acc.className = 'account flex-1 border border-gray-300 rounded-md p-2.5';
        acc.placeholder = 'ê³„ì¢Œë²ˆí˜¸';
        acc.value = d.account || '';
        acc.autocomplete = 'off';
        acc.inputMode = 'numeric';
        acc.pattern = '[0-9]*';
        bankAccountWrap.appendChild(acc);
      } else {
        // select + ê³„ì¢Œë²ˆí˜¸
        const sel = document.createElement('select');
        sel.className = 'bank-select w-24 border border-gray-300 rounded-md p-2.5';
        // 'ì€í–‰ì„ íƒ' ì˜µì…˜
        const optDefault = document.createElement('option');
        optDefault.value = '';
        optDefault.textContent = 'ì€í–‰ì„ íƒ';
        optDefault.disabled = true;
        optDefault.selected = !val;
        optDefault.hidden = true;
        sel.appendChild(optDefault);
        BANKS.forEach(b => {
          const opt = document.createElement('option');
          opt.value = b;
          opt.textContent = b;
          if (val === b) opt.selected = true;
          sel.appendChild(opt);
        });
        const optDirect = document.createElement('option');
        optDirect.value = 'ì§ì ‘ì…ë ¥';
        optDirect.textContent = 'ì§ì ‘ì…ë ¥';
        if (val && !BANKS.includes(val)) optDirect.selected = true;
        sel.appendChild(optDirect);
        sel.onchange = () => {
          if (sel.value === 'ì§ì ‘ì…ë ¥') {
            renderBankField('ì§ì ‘ì…ë ¥');
          } else {
            renderBankField(sel.value);
          }
        };
        bankAccountWrap.appendChild(sel);
        // ê³„ì¢Œë²ˆí˜¸ input
        const acc = document.createElement('input');
        acc.className = 'account flex-1 border border-gray-300 rounded-md p-2.5';
        acc.placeholder = 'ê³„ì¢Œë²ˆí˜¸';
        acc.value = d.account || '';
        acc.autocomplete = 'off';
        acc.inputMode = 'numeric';
        acc.pattern = '[0-9]*';
        bankAccountWrap.appendChild(acc);
      }
    }
    renderBankField(isDirect ? bankVal : (BANKS.includes(bankVal) ? bankVal : ""));
    // ì´ë™/ì‚­ì œ ë²„íŠ¼ ì´ë²¤íŠ¸
    const upBtn = box.querySelector('.move-up');
    const downBtn = box.querySelector('.move-down');
    const delBtn = box.querySelector(".delete-btn");
    upBtn.onclick = () => {
      if (box.previousElementSibling) {
        box.parentNode.insertBefore(box, box.previousElementSibling);
        reIndex();
        updateMoveBtnState();
      }
    };
    downBtn.onclick = () => {
      if (box.nextElementSibling) {
        box.parentNode.insertBefore(box.nextElementSibling, box);
        reIndex();
        updateMoveBtnState();
      }
    };
    delBtn.onclick=()=>{
      const idx = Array.from(box.parentNode.children).indexOf(box) + 1;
      showDeleteModal(box, idx);
    };
    wrap.appendChild(box);
    updateMoveBtnState();
  }
  const reIndex=()=>Array.from(document.querySelectorAll("#mournersWrap>div")).forEach((el,i)=>el.querySelector("span").textContent=`ìƒì£¼ ${i+1}`);
  // ì´ë™ë²„íŠ¼ í™œì„±/ë¹„í™œì„± ê´€ë¦¬
  function updateMoveBtnState() {
    const boxes = Array.from(document.querySelectorAll("#mournersWrap>div"));
    boxes.forEach((box, i) => {
      const upBtn = box.querySelector('.move-up');
      const downBtn = box.querySelector('.move-down');
      upBtn.disabled = i === 0;
      downBtn.disabled = i === boxes.length - 1;
      upBtn.style.opacity = upBtn.disabled ? 0.4 : 1;
      downBtn.style.opacity = downBtn.disabled ? 0.4 : 1;
      upBtn.style.cursor = upBtn.disabled ? 'not-allowed' : 'pointer';
      downBtn.style.cursor = downBtn.disabled ? 'not-allowed' : 'pointer';
    });
  }

  /* â–¶ ìƒíƒœ ê´€ë¦¬ */
  function reset(){["deceasedName","gender","deceasedAge","religion","origin","funeralHall","hallRoom","burialSite"].forEach(id=>$(id).value="");$("mournersWrap").innerHTML="";}
  function load(d){reset();$("deceasedName").value=d.deceased;$("gender").value=d.gender;$("deceasedAge").value=d.age;$("religion").value=d.religion;$("origin").value=d.origin;$("funeralHall").value=d.funeralHall;$("hallRoom").value=d.hallRoom;$("burialSite").value=d.burialSite;d.mourners.forEach(addRow);}

  /* â–¶ ì œì¶œ */
  $("submitBtn").onclick=async()=>{
    $("submitBtn").style.display = "none";
    info("ì €ì¥ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”", false);
    const mourners=[];document.querySelectorAll("#mournersWrap>div").forEach(div=>{
      const n=div.querySelector(".name").value.trim();
      if(n) {
        let bankSel = div.querySelector('.bank-select');
        let bankInp = div.querySelector('.bank-input');
        let bank = '';
        if (bankSel) {
          bank = bankSel.value;
        } else if (bankInp) {
          bank = bankInp.value.trim();
        }
        let phone = div.querySelector(".phone").value.trim();
        if (phone && !phone.startsWith("'")) {
          phone = "'" + phone;
        }
        mourners.push({
          relation:div.querySelector(".relation").value,
          name:n,
          phone:phone,
          bank:bank,
          account:div.querySelector(".account").value
        });
      }
    });
    if(!mourners.length){info("ìƒì£¼ ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”",true);$("submitBtn").style.display = "";return;}
    const data={timestamp:new Date().toLocaleString("ko-KR"),deceased:$("deceasedName").value,gender:$("gender").value,age:$("deceasedAge").value,religion:$("religion").value,origin:$("origin").value,funeralHall:$("funeralHall").value,hallRoom:$("hallRoom").value,burialSite:$("burialSite").value,mourners};
    try{
      await fetch(SHEET,{method:"POST",mode:"no-cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(data)});
      info("ì €ì¥ ì™„ë£Œ");
    }catch(e){
      console.error(e);
      info("ì¸í„°ë„· ì—°ê²°ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”",true);
    }
    render(data);show("summary");
    info("", false);
    $("submitBtn").style.display = "";
  };

  function render(d){
    $("summaryContent").innerHTML = `
      <div>
        <div class="font-semibold text-gray-700 text-lg mb-1">ê³ ì¸ë¶„ ì¸ì ì‚¬í•­</div>
        <div class="flex items-center mb-3">
          <span class="text-base mr-2" style="color:var(--accent);">â—</span>
          <span class="text-lg whitespace-nowrap">æ•… <b>${d.deceased}</b> ë‹˜ (${d.gender||'-'}, ${d.age||'-'}ì„¸, ${d.religion||'-'}, ${d.origin||'-'})</span>
        </div>
        <div class="flex items-center mb-1">
          <span class="font-semibold text-gray-700 text-lg mr-2">ì¥ë¡€ì‹ì¥/ë¹ˆì†Œ</span>
          <span class="text-lg whitespace-nowrap">${d.funeralHall||'-'}${d.hallRoom?` (${d.hallRoom})`:''}</span>
        </div>
        <div class="flex items-center mb-1">
          <span class="font-semibold text-gray-700 text-lg mr-2">ì¥ì§€</span>
          <span class="text-lg whitespace-nowrap">${d.burialSite||'-'}</span>
        </div>
      </div>
      <hr class="my-4">
      <div class="space-y-3">
        ${d.mourners.map((m,i)=>{
          const phone = (m.phone||'').replace(/^'/, '');
          return `
            <div>
              <span class='font-semibold text-lg whitespace-nowrap'>${i+1}. [${m.relation}] ${m.name}</span>
              <span class="text-lg whitespace-nowrap">(${phone})</span><br>
              <span class='text-gray-600 text-base whitespace-nowrap'>${m.bank} ${m.account}</span>
            </div>
          `;
        }).join("")}
      </div>
    `;
  }

  $("editBtn").onclick=()=>show("formPage");

  // ì‚­ì œ ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜
  function showDeleteModal(targetBox, idx) {
    const modal = document.getElementById('deleteModal');
    const msg = document.getElementById('deleteModalMsg');
    msg.textContent = `ìƒì£¼${idx}ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;
    modal.classList.remove('hidden');
    // ì˜ˆ ë²„íŠ¼
    const yesBtn = document.getElementById('deleteModalYes');
    // ì•„ë‹ˆì˜¤ ë²„íŠ¼
    const noBtn = document.getElementById('deleteModalNo');
    // ê¸°ì¡´ ì´ë²¤íŠ¸ ì œê±°
    yesBtn.onclick = null;
    noBtn.onclick = null;
    yesBtn.onclick = () => {
      targetBox.remove();
      modal.classList.add('hidden');
      reIndex();
      updateMoveBtnState();
    };
    noBtn.onclick = () => {
      modal.classList.add('hidden');
    };
  }
})();
</script>
<div id="deleteModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-30 hidden">
  <div class="bg-white rounded-lg shadow-lg p-6 w-80 max-w-full text-center">
    <div id="deleteModalMsg" class="mb-5 text-base text-gray-800 font-semibold"></div>
    <div class="flex justify-center gap-4">
      <button id="deleteModalYes" class="px-4 py-1.5 rounded bg-red-500 text-white font-semibold hover:bg-red-600">ì˜ˆ</button>
      <button id="deleteModalNo" class="px-4 py-1.5 rounded bg-gray-200 text-gray-700 font-semibold hover:bg-gray-300">ì•„ë‹ˆì˜¤</button>
    </div>
  </div>
</div>
</body>
</html>
